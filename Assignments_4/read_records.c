#include <stdio.h>#include <stdlib.h>#include <string.h>#define HEADER_RECORD_SIZE 16#define PAGE_SIZE 512#define PAGE_HEADER_SIZE 64#define RECORD_SIZE 100void read_file_header(FILE *file, unsigned short *total_pages, char *reserved) {    fread(total_pages, sizeof(unsigned short), 1, file);    fread(reserved, sizeof(char), 14, file);}void read_page_header(FILE *file, unsigned short *num_records, unsigned short *free_space, char *reserved, unsigned short *offsets, int max_records) {    fread(num_records, sizeof(unsigned short), 1, file);    fread(free_space, sizeof(unsigned short), 1, file);    fread(reserved, sizeof(char), 4, file);    fread(offsets, sizeof(unsigned short), max_records, file);}void read_record(FILE *file, int record_offset, char *buffer, size_t record_size) {//	printf("record_offset: %d\n", record_offset);    fseek(file, record_offset, SEEK_SET);    fread(buffer, record_size, 1, file);    buffer[record_size] = '\0';  // Null-terminate the string}int main() {    FILE *input_file = fopen("students.dat", "rb");    if (input_file == NULL) {        perror("Failed to open students.dat");        return EXIT_FAILURE;    }    FILE *output_file = fopen("records_output.txt", "w");    if (output_file == NULL) {        perror("Failed to open records_output.txt");        fclose(input_file);        return EXIT_FAILURE;    }    unsigned short total_pages;    char file_reserved[14];	    read_file_header(input_file, &total_pages, file_reserved);/*    fprintf(output_file, "Total pages: %u\n", total_pages);    fprintf(output_file, "File reserved space: ");    for (int i = 0; i < 14; i++) {        fprintf(output_file, "%02x ", (unsigned char)file_reserved[i]);    }    fprintf(output_file, "\n");*/    for (int page_number = 0; page_number < total_pages; page_number++) {        fseek(input_file, 16 + page_number * PAGE_SIZE, SEEK_SET);        unsigned short num_records, free_space;		int record_offset, record_size;        char page_reserved[4];        unsigned short offsets[(PAGE_SIZE - PAGE_HEADER_SIZE) / sizeof(unsigned short)];		        read_page_header(input_file, &num_records, &free_space, page_reserved, offsets, (PAGE_SIZE - PAGE_HEADER_SIZE) / sizeof(unsigned short));/*        fprintf(output_file, "\nPage %d:\n", page_number);        fprintf(output_file, "  Number of records: %u\n", num_records);        fprintf(output_file, "  Free space: %u\n", free_space);        fprintf(output_file, "  Offsets: ");		for (int i=0; i < num_records; i++) {			fprintf(output_file, "%d ", offsets[i]);		}		fprintf(output_file, "\n");*/				printf("#records: %d\n", num_records);		printf("record offsets: ");		for (int i=0; i < num_records; i++) {			printf("%d ", offsets[i]);		}		printf("\n");			        record_offset = HEADER_RECORD_SIZE + page_number * PAGE_SIZE + PAGE_HEADER_SIZE;        for (int i = 0; i < num_records; i++) {            if (offsets[i] == 0 || offsets[i] >= PAGE_SIZE) {                fprintf(output_file, "  Invalid offset for record %d\n", i + 1);                continue; // Skip invalid offsets            }			if(i == 0) {				record_size = offsets[0]+1;			} else {				record_size = offsets[i] - offsets[i-1];			}				            char buffer[RECORD_SIZE + 1];  // Buffer to read the entire record            read_record(input_file, record_offset, buffer, record_size);			record_offset += record_size;			//			printf("**record_offset: %d record_size: %d\n", record_offset, record_size);            fprintf(output_file, "%s\n", buffer);			printf("%s\n", buffer);        }    }    fclose(input_file);    fclose(output_file);    return EXIT_SUCCESS;}